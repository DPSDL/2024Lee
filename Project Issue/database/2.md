## 聚簇索引和非聚簇索引在B+树里面存储有什么区别？

在数据库管理系统中，特别是使用 B+ 树存储索引时，聚簇索引（Clustered Index）和非聚簇索引（Non-Clustered Index）有着显著的存储方式和访问机制的区别。以下是对两者的详细解释。


### 聚簇索引（Clustered Index）

1. **存储方式**：
    - 聚簇索引决定了表中数据的物理存储顺序，数据行的存储与索引直接关联。因此，每个表只能有一个聚簇索引。
    - 数据行本身在 B+ 树的叶子节点中。也就是说，B+ 树的叶子节点存储了实际的数据行。

2. **树的结构**：
    - 当使用聚簇索引时，B+ 树的叶节点同时是数据页，其他节点是对数据的引用（键值对）。

3. **访问效率**：
    - 查询通过聚簇索引时，数据获取速度较快，因为索引直接指向数据行，通常只需一次 I/O 操作。
    - 在范围查询时，聚簇索引特别高效，因为数据是按顺序存储的，能够较快地遍历连续的记录。

4. **示例**：
    - 默认情况下，通常在主键列上创建聚簇索引，假设有一张 `users` 表，其主键为 `id`，聚簇索引的结构如下：
      ```
      B+ 树结构：
      ├── 根节点（键）
      │   ├── 子节点（指向叶节点）
      └── 叶节点（实际的数据行或数据行的指针）
      ```

### 非聚簇索引（Non-Clustered Index）

1. **存储方式**：
    - 非聚簇索引是一个独立于数据存储的结构，索引和数据表可以不按照相同的顺序存储。因此，一个表可以有多个非聚簇索引。
    - 非聚簇索引的叶节点存储的是索引的键值和指向数据行的指针（或行 ID）。

2. **树的结构**：
    - 在 B+ 树中，叶节点不存储实际的数据，而是存储索引的键值和对应的行指针，指向存储在其他位置的实际数据。

3. **访问效率**：
    - 查询通过非聚簇索引时，往往需要两次 I/O 操作：第一次读取非聚簇索引，找到指向数据行的指针，第二次使用该指针访问数据行。这使得非聚簇索引在某些情况下效率较低。
    - 对于非唯一的非聚簇索引，如果存在多个行指向相同的键，可能导致额外的查找开销。

4. **示例**：
    - 如果在 `users` 表中创建一个非聚簇索引以提高 `email` 列的查询性能，索引结构如下：
      ```
      B+ 树结构：
      ├── 根节点（键）
      │   ├── 子节点（指向叶节点）
      └── 叶节点（索引的键值和指向实际数据行的指针，例如：邮箱和行 ID）
      ```

### 总结

- **聚簇索引**：
    - 每个数据行对应一个叶子节点。
    - 物理存储顺序与索引顺序一致。
    - 只能有一个聚簇索引（通常为主键）。

- **非聚簇索引**：
    - 数据行与索引独立存储。
    - 可以有多个非聚簇索引。
    - 叶子节点存储指向数据行的指针。

了解这两种索引的结构和行为，对于合理设计数据库索引、优化查询速度等都是至关重要的。如有任何其他问题或者需要更深入的讨论，欢迎继续提问！